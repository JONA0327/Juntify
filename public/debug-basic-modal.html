<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Plan Basic y Modal</title>
    <style>
        body {
            font-family: monospace;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        .debug-section {
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .debug-section h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        .test-result {
            padding: 1rem;
            border-radius: 6px;
            margin: 0.5rem 0;
        }
        .success {
            background: #065f46;
            color: #d1fae5;
        }
        .error {
            background: #7f1d1d;
            color: #fecaca;
        }
        .info {
            background: #1e3a8a;
            color: #dbeafe;
        }
        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-weight: 600;
        }
        .btn-test {
            background: #3b82f6;
            color: white;
        }
        .btn-close {
            background: #ef4444;
            color: white;
        }
        .console-log {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .variable {
            color: #fbbf24;
        }
        .value {
            color: #34d399;
        }
    </style>
</head>
<body>
    <h1>üêõ Debug: Plan Basic y Modal</h1>

    <div class="debug-section">
        <h3>üîç Variables de Usuario</h3>
        <div id="user-vars" class="console-log"></div>
    </div>

    <div class="debug-section">
        <h3>üß™ Prueba de Acceso a Contenedores</h3>
        <button class="btn-test" onclick="testContainerAccess()">
            Probar canCreateContainers()
        </button>
        <div id="container-test-result"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ Simulaci√≥n de Creaci√≥n de Contenedor</h3>
        <button class="btn-test" onclick="simulateContainerCreation()">
            Simular Crear Contenedor
        </button>
        <div id="simulation-result"></div>
    </div>

    <div class="debug-section">
        <h3>üîí Prueba de Cierre de Modal</h3>
        <button class="btn-test" onclick="testModalClose()">
            Probar Cerrar Modal
        </button>
        <button class="btn-close" onclick="forceCloseModal()">
            Forzar Cierre
        </button>
        <div id="modal-test-result"></div>
    </div>

    <script>
        // Cargar variables de usuario
        function loadUserVars() {
            const userVarsEl = document.getElementById('user-vars');
            const vars = {
                userPlanCode: window.userPlanCode || 'No definido',
                userRole: window.userRole || 'No definido',
                userId: window.userId || 'No definido',
                userBelongsToOrganization: window.userBelongsToOrganization || false
            };

            userVarsEl.innerHTML = Object.entries(vars).map(([key, value]) =>
                `<span class="variable">${key}:</span> <span class="value">${JSON.stringify(value)}</span>`
            ).join('<br>');
        }

        // Probar acceso a contenedores
        function testContainerAccess() {
            const resultEl = document.getElementById('container-test-result');

            try {
                const canCreate = window.canCreateContainers ? window.canCreateContainers() : 'Funci√≥n no definida';

                if (canCreate === true) {
                    resultEl.innerHTML = '<div class="test-result success">‚úÖ Usuario PUEDE crear contenedores</div>';
                } else if (canCreate === false) {
                    resultEl.innerHTML = '<div class="test-result error">‚ùå Usuario NO puede crear contenedores</div>';
                } else {
                    resultEl.innerHTML = '<div class="test-result error">‚ö†Ô∏è Funci√≥n no encontrada</div>';
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Simular creaci√≥n de contenedor
        function simulateContainerCreation() {
            const resultEl = document.getElementById('simulation-result');
            resultEl.innerHTML = '<div class="test-result info">üîÑ Simulando...</div>';

            try {
                // Simular la l√≥gica de openCreateContainerModal
                const canCreate = window.canCreateContainers ? window.canCreateContainers() : false;

                if (!canCreate) {
                    resultEl.innerHTML = '<div class="test-result error">üö´ Se mostrar√≠a modal de upgrade</div>';

                    // Intentar mostrar el modal
                    if (window.showUpgradeModal) {
                        window.showUpgradeModal({
                            title: 'Contenedores disponibles desde Plan Basic',
                            message: 'La creaci√≥n de contenedores est√° disponible para los planes: <strong>Basic</strong>, <strong>Business</strong> y <strong>Enterprise</strong>.',
                            icon: 'lock'
                        });
                    }
                } else {
                    resultEl.innerHTML = '<div class="test-result success">‚úÖ Se abrir√≠a modal de creaci√≥n de contenedor</div>';
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Probar cierre de modal
        function testModalClose() {
            const resultEl = document.getElementById('modal-test-result');

            try {
                if (window.closeUpgradeModal) {
                    window.closeUpgradeModal();
                    resultEl.innerHTML = '<div class="test-result success">‚úÖ Funci√≥n closeUpgradeModal ejecutada</div>';
                } else {
                    resultEl.innerHTML = '<div class="test-result error">‚ùå Funci√≥n closeUpgradeModal no encontrada</div>';
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Forzar cierre de modal
        function forceCloseModal() {
            const resultEl = document.getElementById('modal-test-result');

            try {
                // Buscar todos los modales posibles
                const modals = document.querySelectorAll('.modal, [id*="modal"]');
                let closed = 0;

                modals.forEach(modal => {
                    if (modal.style.display === 'flex' || modal.classList.contains('show') || modal.classList.contains('active')) {
                        modal.style.setProperty('display', 'none', 'important');
                        modal.style.setProperty('visibility', 'hidden', 'important');
                        modal.style.setProperty('opacity', '0', 'important');
                        modal.classList.remove('show', 'active');
                        closed++;
                    }
                });

                document.body.style.setProperty('overflow', '', 'important');

                resultEl.innerHTML = `<div class="test-result success">üî® Forzado cierre de ${closed} modales</div>`;
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Cargar variables al iniciar
        window.addEventListener('load', () => {
            loadUserVars();
        });
    </script>
</body>
</html>
