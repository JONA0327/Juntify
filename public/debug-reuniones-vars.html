<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Reuniones - Variables</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #0f0f0f;
            color: #e0e0e0;
            line-height: 1.6;
        }
        .debug-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .debug-section h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        .variable-list {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .variable {
            color: #fbbf24;
        }
        .value {
            color: #34d399;
        }
        .error {
            color: #ef4444;
        }
        .success {
            color: #10b981;
        }
        .warning {
            color: #f59e0b;
        }
        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-weight: 600;
            background: #3b82f6;
            color: white;
        }
        button:hover {
            background: #2563eb;
        }
        .btn-danger {
            background: #ef4444;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-success:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Reuniones - Variables Globales</h1>

    <div class="debug-section">
        <h3>üìä Variables Globales Disponibles</h3>
        <div id="global-vars" class="variable-list"></div>
        <button onclick="refreshGlobalVars()">Actualizar Variables</button>
    </div>

    <div class="debug-section">
        <h3>üß™ Test de Funciones</h3>
        <button onclick="testCanCreateContainers()">Test: canCreateContainers()</button>
        <button onclick="testGetLimits()">Test: getContainerLimits()</button>
        <button onclick="testCanCreateMore()">Test: canCreateMoreContainers()</button>
        <div id="function-results" class="variable-list" style="margin-top: 1rem;"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ Simulaci√≥n de Creaci√≥n de Contenedor</h3>
        <button onclick="simulateContainerCreation()" class="btn-success">Simular Crear Contenedor</button>
        <button onclick="forceShowModal()" class="btn-danger">Forzar Modal</button>
        <div id="simulation-results" class="variable-list" style="margin-top: 1rem;"></div>
    </div>

    <div class="debug-section">
        <h3>üîß Diagn√≥stico Autom√°tico</h3>
        <button onclick="runDiagnostic()">Ejecutar Diagn√≥stico</button>
        <div id="diagnostic-results" class="variable-list" style="margin-top: 1rem;"></div>
    </div>

    <script>
        function refreshGlobalVars() {
            const varsEl = document.getElementById('global-vars');
            const vars = {
                'window.userRole': window.userRole,
                'window.userPlanCode': window.userPlanCode,
                'window.userId': window.userId,
                'window.userName': window.userName,
                'window.userBelongsToOrganization': window.userBelongsToOrganization,
                'window.currentOrganizationId': window.currentOrganizationId,
                'typeof window.canCreateContainers': typeof window.canCreateContainers,
                'typeof window.getContainerLimits': typeof window.getContainerLimits,
                'typeof window.canCreateMoreContainers': typeof window.canCreateMoreContainers,
                'typeof window.showUpgradeModal': typeof window.showUpgradeModal,
                'typeof window.closeUpgradeModal': typeof window.closeUpgradeModal
            };

            varsEl.innerHTML = Object.entries(vars).map(([key, value]) => {
                let color = 'value';
                if (value === undefined || value === null) color = 'error';
                else if (value === 'function') color = 'success';
                else if (typeof value === 'boolean') color = value ? 'success' : 'warning';

                return `<span class="variable">${key}:</span> <span class="${color}">${JSON.stringify(value)}</span>`;
            }).join('<br>');
        }

        function testCanCreateContainers() {
            const resultEl = document.getElementById('function-results');

            try {
                if (typeof window.canCreateContainers !== 'function') {
                    resultEl.innerHTML = '<span class="error">‚ùå Funci√≥n canCreateContainers no encontrada</span>';
                    return;
                }

                console.log('üß™ Ejecutando test de canCreateContainers...');
                const result = window.canCreateContainers();

                const color = result ? 'success' : 'error';
                const icon = result ? '‚úÖ' : '‚ùå';
                resultEl.innerHTML = `<span class="${color}">${icon} canCreateContainers() = ${result}</span>`;

            } catch (error) {
                resultEl.innerHTML = `<span class="error">üí• Error: ${error.message}</span>`;
            }
        }

        function testGetLimits() {
            const resultEl = document.getElementById('function-results');

            try {
                if (typeof window.getContainerLimits !== 'function') {
                    resultEl.innerHTML += '<br><span class="error">‚ùå Funci√≥n getContainerLimits no encontrada</span>';
                    return;
                }

                const limits = window.getContainerLimits();
                resultEl.innerHTML += `<br><span class="success">üìä L√≠mites: ${JSON.stringify(limits)}</span>`;

            } catch (error) {
                resultEl.innerHTML += `<br><span class="error">üí• Error: ${error.message}</span>`;
            }
        }

        function testCanCreateMore() {
            const resultEl = document.getElementById('function-results');

            try {
                if (typeof window.canCreateMoreContainers !== 'function') {
                    resultEl.innerHTML += '<br><span class="error">‚ùå Funci√≥n canCreateMoreContainers no encontrada</span>';
                    return;
                }

                const canCreateMore = window.canCreateMoreContainers(0);
                const color = canCreateMore ? 'success' : 'warning';
                const icon = canCreateMore ? '‚úÖ' : '‚ö†Ô∏è';
                resultEl.innerHTML += `<br><span class="${color}">${icon} canCreateMoreContainers(0) = ${canCreateMore}</span>`;

            } catch (error) {
                resultEl.innerHTML += `<br><span class="error">üí• Error: ${error.message}</span>`;
            }
        }

        function simulateContainerCreation() {
            const resultEl = document.getElementById('simulation-results');

            try {
                // Simular la l√≥gica de openCreateContainerModal
                console.log('üéØ Simulando creaci√≥n de contenedor...');

                const canCreate = window.canCreateContainers ? window.canCreateContainers() : false;

                if (!canCreate) {
                    resultEl.innerHTML = '<span class="error">üö´ Se mostrar√≠a modal de upgrade (simulaci√≥n)</span>';

                    // Mostrar el modal real si est√° disponible
                    if (window.showUpgradeModal) {
                        window.showUpgradeModal({
                            title: 'Contenedores disponibles desde Plan Basic',
                            message: 'La creaci√≥n de contenedores est√° disponible para los planes: <strong>Basic</strong>, <strong>Business</strong> y <strong>Enterprise</strong>.',
                            icon: 'lock'
                        });
                    }
                } else {
                    resultEl.innerHTML = '<span class="success">‚úÖ Se abrir√≠a modal de creaci√≥n de contenedor</span>';
                }
            } catch (error) {
                resultEl.innerHTML = `<span class="error">üí• Error: ${error.message}</span>`;
            }
        }

        function forceShowModal() {
            if (window.showUpgradeModal) {
                window.showUpgradeModal({
                    title: 'Modal de Prueba',
                    message: 'Este es un modal de prueba para verificar que funciona.',
                    icon: 'lock'
                });
            } else {
                alert('Funci√≥n showUpgradeModal no disponible');
            }
        }

        function runDiagnostic() {
            const resultEl = document.getElementById('diagnostic-results');
            let diagnosis = [];

            // Verificar variables b√°sicas
            if (!window.userRole) {
                diagnosis.push('<span class="error">‚ùå window.userRole no definido</span>');
            } else if (window.userRole === 'basic') {
                diagnosis.push('<span class="success">‚úÖ userRole es "basic"</span>');
            } else {
                diagnosis.push(`<span class="warning">‚ö†Ô∏è userRole es "${window.userRole}" (no basic)</span>`);
            }

            if (!window.userPlanCode) {
                diagnosis.push('<span class="error">‚ùå window.userPlanCode no definido</span>');
            } else {
                diagnosis.push(`<span class="value">üìã userPlanCode: "${window.userPlanCode}"</span>`);
            }

            // Verificar funciones
            if (typeof window.canCreateContainers !== 'function') {
                diagnosis.push('<span class="error">‚ùå Funci√≥n canCreateContainers no disponible</span>');
            } else {
                try {
                    const result = window.canCreateContainers();
                    if (window.userRole === 'basic' && !result) {
                        diagnosis.push('<span class="error">üö® PROBLEMA: Usuario basic NO puede crear contenedores</span>');
                    } else if (window.userRole === 'basic' && result) {
                        diagnosis.push('<span class="success">‚úÖ CORRECTO: Usuario basic PUEDE crear contenedores</span>');
                    }
                } catch (e) {
                    diagnosis.push(`<span class="error">üí• Error ejecutando canCreateContainers: ${e.message}</span>`);
                }
            }

            resultEl.innerHTML = diagnosis.join('<br>');
        }

        // Cargar variables al iniciar
        window.addEventListener('load', () => {
            refreshGlobalVars();
            setTimeout(runDiagnostic, 500);
        });
    </script>
</body>
</html>
