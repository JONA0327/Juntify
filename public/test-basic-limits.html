<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - L√≠mites Plan Basic</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .test-section h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        .test-result {
            padding: 1rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            border-left: 4px solid;
        }
        .success {
            background: #065f46;
            color: #d1fae5;
            border-color: #10b981;
        }
        .error {
            background: #7f1d1d;
            color: #fecaca;
            border-color: #ef4444;
        }
        .info {
            background: #1e3a8a;
            color: #dbeafe;
            border-color: #3b82f6;
        }
        .warning {
            background: #92400e;
            color: #fef3c7;
            border-color: #f59e0b;
        }
        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            font-weight: 600;
        }
        .btn-test {
            background: #3b82f6;
            color: white;
        }
        .btn-limit {
            background: #f59e0b;
            color: white;
        }
        .console-log {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            font-size: 0.875rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .variable {
            color: #fbbf24;
        }
        .value {
            color: #34d399;
        }
        .limits-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .limits-table th,
        .limits-table td {
            border: 1px solid #404040;
            padding: 0.5rem;
            text-align: left;
        }
        .limits-table th {
            background: #374151;
            color: #f9fafb;
        }
        .limits-table .plan-free {
            color: #ef4444;
        }
        .limits-table .plan-basic {
            color: #3b82f6;
        }
        .limits-table .plan-premium {
            color: #10b981;
        }
    </style>
</head>
<body>
    <h1>üß™ Test: L√≠mites Plan Basic</h1>

    <div class="test-section">
        <h3>üìã L√≠mites por Plan</h3>
        <table class="limits-table">
            <thead>
                <tr>
                    <th>Plan</th>
                    <th>Contenedores</th>
                    <th>Reuniones/Contenedor</th>
                </tr>
            </thead>
            <tbody>
                <tr class="plan-free">
                    <td>Free</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="plan-basic">
                    <td>Basic</td>
                    <td>3</td>
                    <td>10</td>
                </tr>
                <tr class="plan-premium">
                    <td>Premium+</td>
                    <td>999</td>
                    <td>999</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h3>üîç Variables de Usuario</h3>
        <div id="user-vars" class="console-log"></div>
    </div>

    <div class="test-section">
        <h3>üß™ Pruebas de Funciones</h3>
        <button class="btn-test" onclick="testCanCreateContainers()">
            Test: canCreateContainers()
        </button>
        <button class="btn-test" onclick="testGetLimits()">
            Test: getContainerLimits()
        </button>
        <button class="btn-limit" onclick="testLimits()">
            Test: Verificar L√≠mites
        </button>
        <div id="function-tests"></div>
    </div>

    <div class="test-section">
        <h3>üì¶ Simulaci√≥n de Contenedores</h3>
        <button class="btn-test" onclick="simulateContainerCreation(0)">
            Simular: 0 contenedores
        </button>
        <button class="btn-test" onclick="simulateContainerCreation(2)">
            Simular: 2 contenedores
        </button>
        <button class="btn-test" onclick="simulateContainerCreation(3)">
            Simular: 3 contenedores
        </button>
        <button class="btn-test" onclick="simulateContainerCreation(4)">
            Simular: 4 contenedores
        </button>
        <div id="container-simulation"></div>
    </div>

    <div class="test-section">
        <h3>üìù Simulaci√≥n de Reuniones por Contenedor</h3>
        <button class="btn-test" onclick="simulateMeetingAddition(5)">
            Simular: 5 reuniones
        </button>
        <button class="btn-test" onclick="simulateMeetingAddition(9)">
            Simular: 9 reuniones
        </button>
        <button class="btn-test" onclick="simulateMeetingAddition(10)">
            Simular: 10 reuniones
        </button>
        <button class="btn-test" onclick="simulateMeetingAddition(11)">
            Simular: 11 reuniones
        </button>
        <div id="meeting-simulation"></div>
    </div>

    <script>
        // Variables globales de prueba
        window.userPlanCode = 'basic';
        window.userRole = 'basic';
        window.userId = 'test-user-123';
        window.userBelongsToOrganization = false;

        // Cargar variables de usuario
        function loadUserVars() {
            const userVarsEl = document.getElementById('user-vars');
            const vars = {
                userPlanCode: window.userPlanCode || 'No definido',
                userRole: window.userRole || 'No definido',
                userId: window.userId || 'No definido',
                userBelongsToOrganization: window.userBelongsToOrganization || false
            };

            userVarsEl.innerHTML = Object.entries(vars).map(([key, value]) =>
                `<span class="variable">${key}:</span> <span class="value">${JSON.stringify(value)}</span>`
            ).join('<br>');
        }

        // Probar canCreateContainers
        function testCanCreateContainers() {
            const resultEl = document.getElementById('function-tests');

            try {
                const canCreate = window.canCreateContainers ? window.canCreateContainers() : 'Funci√≥n no definida';

                let resultClass = 'info';
                let message = '';

                if (canCreate === true) {
                    resultClass = 'success';
                    message = '‚úÖ canCreateContainers() = true (Plan Basic puede crear contenedores)';
                } else if (canCreate === false) {
                    resultClass = 'error';
                    message = '‚ùå canCreateContainers() = false (Plan Basic NO puede crear contenedores)';
                } else {
                    resultClass = 'error';
                    message = '‚ö†Ô∏è Funci√≥n canCreateContainers no encontrada';
                }

                resultEl.innerHTML = `<div class="test-result ${resultClass}">${message}</div>`;
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Probar getContainerLimits
        function testGetLimits() {
            const resultEl = document.getElementById('function-tests');

            try {
                const limits = window.getContainerLimits ? window.getContainerLimits() : null;

                if (limits) {
                    const expectedLimits = { maxContainers: 3, maxMeetingsPerContainer: 10 };
                    const isCorrect = limits.maxContainers === expectedLimits.maxContainers &&
                                    limits.maxMeetingsPerContainer === expectedLimits.maxMeetingsPerContainer;

                    const resultClass = isCorrect ? 'success' : 'warning';
                    const message = isCorrect
                        ? '‚úÖ getContainerLimits() correcto: 3 contenedores, 10 reuniones/contenedor'
                        : `‚ö†Ô∏è L√≠mites incorrectos: ${JSON.stringify(limits)} (esperado: ${JSON.stringify(expectedLimits)})`;

                    resultEl.innerHTML += `<div class="test-result ${resultClass}">${message}</div>`;
                } else {
                    resultEl.innerHTML += `<div class="test-result error">‚ùå Funci√≥n getContainerLimits no encontrada</div>`;
                }
            } catch (error) {
                resultEl.innerHTML += `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Probar todas las funciones
        function testLimits() {
            testCanCreateContainers();
            setTimeout(() => testGetLimits(), 100);
        }

        // Simular creaci√≥n de contenedores
        function simulateContainerCreation(currentCount) {
            const resultEl = document.getElementById('container-simulation');

            try {
                const canCreateMore = window.canCreateMoreContainers ?
                    window.canCreateMoreContainers(currentCount) : null;
                const limits = window.getContainerLimits ? window.getContainerLimits() : null;

                if (canCreateMore !== null && limits) {
                    const remaining = limits.maxContainers - currentCount;
                    const resultClass = canCreateMore ? 'success' : 'error';
                    const status = canCreateMore ? 'PUEDE' : 'NO PUEDE';
                    const message = `üì¶ ${currentCount} contenedores: ${status} crear m√°s (l√≠mite: ${limits.maxContainers}, restantes: ${remaining})`;

                    resultEl.innerHTML = `<div class="test-result ${resultClass}">${message}</div>`;
                } else {
                    resultEl.innerHTML = `<div class="test-result error">‚ùå Funciones no encontradas</div>`;
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Simular adici√≥n de reuniones
        function simulateMeetingAddition(currentMeetings) {
            const resultEl = document.getElementById('meeting-simulation');

            try {
                const limits = window.getContainerLimits ? window.getContainerLimits() : null;

                if (limits) {
                    const canAdd = currentMeetings < limits.maxMeetingsPerContainer;
                    const remaining = limits.maxMeetingsPerContainer - currentMeetings;
                    const resultClass = canAdd ? 'success' : 'error';
                    const status = canAdd ? 'PUEDE' : 'NO PUEDE';
                    const message = `üìù ${currentMeetings} reuniones: ${status} agregar m√°s (l√≠mite: ${limits.maxMeetingsPerContainer}, restantes: ${Math.max(0, remaining)})`;

                    resultEl.innerHTML = `<div class="test-result ${resultClass}">${message}</div>`;
                } else {
                    resultEl.innerHTML = `<div class="test-result error">‚ùå Funci√≥n getContainerLimits no encontrada</div>`;
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="test-result error">üí• Error: ${error.message}</div>`;
            }
        }

        // Cargar variables al iniciar
        window.addEventListener('load', () => {
            loadUserVars();
        });
    </script>
</body>
</html>
