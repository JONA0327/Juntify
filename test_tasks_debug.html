<!DOCTYPE html>
<html>
<head>
    <title>Debug - Tasks Access Logic</title>
</head>
<body>
    <h1>üîß Debug: Tasks Access Logic</h1>
    <div id="results"></div>

    <!-- Simular global-vars.blade.php -->
    <script>
        (function() {
            try {
                // Simular datos de usuario
                const testUsers = [
                    { name: "Usuario FREE b√°sico", plan_code: "free", roles: null, hasGroups: false },
                    { name: "Usuario FREE con grupos", plan_code: "free", roles: null, hasGroups: true },
                    { name: "Usuario DEVELOPER", plan_code: "free", roles: "developer", hasGroups: false },
                    { name: "Usuario SUPERADMIN", plan_code: "free", roles: "superadmin", hasGroups: false },
                    { name: "Usuario FOUNDER", plan_code: "free", roles: "founder", hasGroups: false },
                    { name: "Usuario BUSINESS", plan_code: "business", roles: null, hasGroups: false },
                    { name: "Usuario ENTERPRISE", plan_code: "enterprise", roles: null, hasGroups: false }
                ];

                // Funci√≥n global showUpgradeModal
                window.showUpgradeModal = function(options = {}) {
                    console.log('üöÄ INICIANDO showUpgradeModal global...', options);
                    alert(`Modal: ${options.title}\n${options.message}`);
                };

                // Funci√≥n para mostrar modal de tareas bloqueadas
                window.showTasksLockedModal = function() {
                    console.log('üö´ Mostrando modal de tareas bloqueadas');
                    window.showUpgradeModal({
                        title: 'Tareas bloqueadas para tu plan actual',
                        message: 'Las tareas est√°n disponibles para los planes: Negocios y Enterprise. Debes actualizar tu plan para acceder a esta funcionalidad.',
                        icon: 'lock',
                        hideCloseButton: false
                    });
                };

                // Simular l√≥gica del navbar
                function testUserAccess(user) {
                    const userPlan = user.plan_code ?? 'free';
                    const belongsToOrg = user.hasGroups ||
                                        ['admin', 'superadmin', 'founder', 'developer'].includes(user.roles);
                    const hasTasksAccess = userPlan !== 'free' || belongsToOrg;

                    return { hasTasksAccess, belongsToOrg, userPlan };
                }

                // Probar todos los usuarios
                let resultsHtml = '<h2>Resultados de prueba:</h2>';
                testUsers.forEach(user => {
                    const result = testUserAccess(user);
                    const status = result.hasTasksAccess ? '‚úÖ ACCESO PERMITIDO' : '‚ùå ACCESO BLOQUEADO';
                    const color = result.hasTasksAccess ? 'green' : 'red';

                    resultsHtml += `
                        <div style="border: 1px solid ${color}; margin: 10px; padding: 10px; background: ${result.hasTasksAccess ? '#e8f5e8' : '#ffe8e8'}">
                            <h3>${user.name} ${status}</h3>
                            <p><strong>Plan:</strong> ${user.plan_code}</p>
                            <p><strong>Roles:</strong> ${user.roles || 'ninguno'}</p>
                            <p><strong>Tiene grupos:</strong> ${user.hasGroups ? 'S√≠' : 'No'}</p>
                            <p><strong>Pertenece a org:</strong> ${result.belongsToOrg ? 'S√≠' : 'No'}</p>
                            <p><strong>Puede acceder a tareas:</strong> ${result.hasTasksAccess ? 'S√≠' : 'No'}</p>
                            ${!result.hasTasksAccess ? '<button onclick="showTasksLockedModal()">Simular click en Tareas</button>' : '<p>‚úÖ Acceso directo a tareas</p>'}
                        </div>
                    `;
                });

                document.getElementById('results').innerHTML = resultsHtml;

            } catch(e) {
                console.error('Error en debug:', e);
                document.getElementById('results').innerHTML = '<p style="color: red;">Error: ' + e.message + '</p>';
            }
        })();
    </script>
</body>
</html>
